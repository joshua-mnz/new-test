pipeline{
agent any
	environment{
	DOCKERHUB_CREDENTIALS=credentials('dockerhubID')
	DOCKER_IMAGE="josh57/new-test"
	}
	stages{
	stage('Checkout')
	{
		steps{
			git(url:"https://github.com/joshua-mnz/new-test",branch:"main")	
		}
	}
	stage('Build')
	{
		steps
		{
			script{ 
			IMG=docker.build("${DOCKER_IMAGE}:latest")
			}
		}
	}
	stage('Docker Push')
	{
		steps
		{
			script{
				docker.withRegistry("https://hub.registry.docker.com","dockerhubID")
		{
			IMG.push()
		}
			}
		}
	}
	}
	post{
		success{
		echo "Success"
		}
		failure
		{
			echo "Failure"
		}
		always
		{
			echo "Cleaning DIR"
			deleteDir()
		}
	}
}
